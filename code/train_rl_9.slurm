#!/bin/bash
#SBATCH --nodes=1
#SBATCH --gres=gpu:1
##SBATCH --exclude=gm[001-024],gv[013-018]
##SBATCH --partition=aquila
#SBATCH --cpus-per-task=6
#SBATCH --mem=128GB
#SBATCH --job-name=hopper_train
#SBATCH --mail-type=END
##SBATCH --mail-user=zw2374@nyu.edu
#SBATCH --time=48:00:00
##SBATCH --dependency=singleton
#SBATCH --output=logs/chibit_%j_rerun_perturb_9.out
#SBATCH --error=logs/chibit_%j_rerun_perturb_9.err
##python experiment.py --env hopper --dataset medium --model_type dt --seed 1024 --pretrained_lm gpt2  --outdir "checkpoints/gpt2_kmeans_medium_positions_hopper_1024" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/gpt2_lm_1000.pt" --gpt_kmeans_const 0.1 --dropout 0.2 --share_input_output_proj
##python experiment.py --env reacher2d --dataset medium --model_type dt --seed 666  --pretrained_lm gpt2  --outdir "checkpoints/gpt2_kmeans_medium_positions_reacher2d_666" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/gpt2_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj
##python eval_model.py --env hopper --dataset medium --model_type dt --seed 666  --pretrained_lm gpt2 --load_checkpoint "/scratch/zw2374/public/can-wikipedia-help-offline-rl/code/checkpoints/gpt2_kmeans_medium_positions_hopper_666/model_3.pt"  --outdir "checkpoints/gpt2_kmeans_medium_positions_hopper_666_eval_again" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/gpt2_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --env_targets "3600"

##python experiment.py --env hopper --dataset medium-expert --model_type dt --seed 666  --pretrained_lm chibiT  --outdir "checkpoints/cibiT_kmeans_medium_expert_positions_hopper_paper_666" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv2_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj
##python experiment.py --env hopper --dataset medium-expert --model_type dt --seed 42  --pretrained_lm chibiT  --outdir "checkpoints/cibiT_kmeans_medium_expert_positions_hopper_paper_42" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv2_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj
##python experiment.py --env hopper --dataset medium-expert --model_type dt --seed 1024  --pretrained_lm chibiT  --outdir "checkpoints/cibiT_kmeans_medium_expert_positions_hopper_paper_1024" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv2_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj

##python experiment.py --env walker2d --dataset medium --model_type dt --seed 666    --outdir "checkpoints/dt_kmeans_medium_positions_walker2d_paper_666" 
##python experiment.py --env walker2d --dataset medium --model_type dt --seed 42  --outdir "checkpoints/dt_kmeans_medium_positions_walker2d_paper_42"  
##python experiment.py --env walker2d --dataset medium --model_type dt --seed 1024  --outdir "checkpoints/dt_kmeans_medium_positions_walker2d_paper_1024"  
singularity exec --nv -B /scratch/$USER/public/can-wikipedia-help-offline-rl-old/code:/code -B /scratch/$USER/sing/dt-sandbox/opt/conda/lib/python3.8/site-packages/mujoco_py/:/opt/conda/lib/python3.8/site-packages/mujoco_py/ -B /scratch/$USER/public/can-wikipedia-help-offline-rl-old/code/checkpoints:/checkpoints /scratch/$USER/sing/dt-sandbox bash -c "
cd /code
export PYTHONPATH=$PYTHONPATH:/code
nvidia-smi
echo $PATH
echo $LD_LIBRARY_PATH
python experiment_new.py --env halfcheetah --dataset medium-replay --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env halfcheetah --dataset medium-replay --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env halfcheetah --dataset medium-replay --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env hopper --dataset medium --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env walker2d --dataset medium --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env hopper --dataset medium-expert --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium-expert --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium-expert --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env hopper --dataset medium-replay --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium-replay --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env hopper --dataset medium-replay --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env walker2d --dataset medium-expert --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium-expert --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium-expert --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env walker2d --dataset medium-replay --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium-replay --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env walker2d --dataset medium-replay --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
python experiment_new.py --env halfcheetah --dataset medium --model_type dt --seed 666 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env halfcheetah --dataset medium --model_type dt --seed 42 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
python experiment_new.py --env halfcheetah --dataset medium --model_type dt --seed 1024 --pretrained_lm pretrain/checkpoints/chibiT_embed_dim128_n_layer3_n_head1/model_final --outdir "chibiT-rerun_perturb_per_layer2e0" --extend_positions --gpt_kmeans 1000 --kmeans_cache "kmeans_cache/chibiv3_lm_1000.pt" --gpt_kmeans_const 0.1  --dropout 0.2 --share_input_output_proj --perturb --perturb_per_layer 2e0 --perturb_transformer_only &
wait
"